(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1],{466:function(e,t,s){Promise.resolve().then(s.bind(s,7563))},7563:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(7821),n=s(8078),r=s(6693),c=s(1621),o=s(8034),l=s(3287),i=s(189),d=s(229),u=s(7485);function h(){var e,t,s,h,m,p;let{shop:g}=(0,d.tN)(),[x,v]=(0,n.useState)("week"),[f,j]=(0,n.useState)(""),[N,y]=(0,n.useState)(""),[b,w]=(0,n.useState)({data:[],totals:{}}),[k,S]=(0,n.useState)([]),[I,A]=(0,n.useState)(!0),D=()=>{let e=new Date,t=e.toISOString().split("T")[0],s=t;if("week"===x){let t=new Date(e);t.setDate(t.getDate()-6),s=t.toISOString().split("T")[0]}else if("month"===x){let t=new Date(e);t.setDate(t.getDate()-29),s=t.toISOString().split("T")[0]}j(s),y(t)};(0,n.useEffect)(()=>{D()},[x]),(0,n.useEffect)(()=>{f&&N&&(async()=>{A(!0);try{let[e,t]=await Promise.all([i.vD.getRevenue({startDate:f,endDate:N}),i.vD.getTopProducts(10)]);w(e.data),S(t.data)}catch(e){console.error("Failed to fetch reports:",e)}finally{A(!1)}})()},[f,N]);let T=Math.max(...(null===(e=b.data)||void 0===e?void 0:e.map(e=>e.revenue))||[1],1);return(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"B\xe1o c\xe1o doanh thu"}),(0,a.jsxs)("button",{className:"btn btn-primary",onClick:()=>{var e,t,s;if(!b.data||0===b.data.length){u.default.error("Kh\xf4ng c\xf3 dữ liệu để xuất");return}let a="\uFEFF";a+="B\xc1O C\xc1O DOANH THU - ".concat((null==g?void 0:g.name)||"QALY BAHA","\n")+"Từ ng\xe0y: ".concat(f," - Đến ng\xe0y: ").concat(N,"\n\n")+"TỔNG KẾT\n"+"Tổng doanh thu,".concat((null===(e=b.totals)||void 0===e?void 0:e.totalRevenue)||0,"\n")+"Số đơn ho\xe0n th\xe0nh,".concat((null===(t=b.totals)||void 0===t?void 0:t.totalOrders)||0,"\n")+"Gi\xe1 trị TB/đơn,".concat((null===(s=b.totals)||void 0===s?void 0:s.avgOrderValue)||0,"\n\n")+"CHI TIẾT THEO NG\xc0Y\nNg\xe0y,Số đơn,Doanh thu\n",[...b.data||[]].reverse().forEach(e=>{a+="".concat(e._id,",").concat(e.orders,",").concat(e.revenue,"\n")}),k.length>0&&(a+="\nSẢN PHẨM B\xc1N CHẠY\nSTT,Sản phẩm,Số lượng b\xe1n,Doanh thu\n",k.forEach((e,t)=>{a+="".concat(t+1,',"').concat(e.productName,'",').concat(e.totalQuantity,",").concat(e.totalRevenue,"\n")}));let n=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(n),c=document.createElement("a");c.href=r,c.download="baocao_".concat(f,"_").concat(N,".csv"),document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r),u.default.success("Đ\xe3 xuất b\xe1o c\xe1o Excel")},disabled:I,children:[(0,a.jsx)(r.Z,{className:"w-4 h-4"})," Xuất Excel"]})]}),(0,a.jsx)("div",{className:"card p-4",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsx)("div",{className:"flex gap-2",children:["today","week","month"].map(e=>(0,a.jsx)("button",{className:"btn ".concat(x===e?"btn-primary":"btn-secondary"),onClick:()=>v(e),children:"today"===e?"H\xf4m nay":"week"===e?"7 ng\xe0y":"30 ng\xe0y"},e))}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-dark-500"}),(0,a.jsx)("input",{type:"date",className:"input w-auto",value:f,onChange:e=>j(e.target.value)}),(0,a.jsx)("span",{className:"text-dark-500",children:"-"}),(0,a.jsx)("input",{type:"date",className:"input w-auto",value:N,onChange:e=>y(e.target.value)})]})]})}),(0,a.jsxs)("div",{className:"grid sm:grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"stats-card",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-6 h-6 text-green-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-dark-400 text-sm",children:"Tổng doanh thu"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(0,d.xG)((null===(t=b.totals)||void 0===t?void 0:t.totalRevenue)||0)})]})]})}),(0,a.jsx)("div",{className:"stats-card",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-500/20 rounded-xl flex items-center justify-center",children:(0,a.jsx)(l.Z,{className:"w-6 h-6 text-primary-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-dark-400 text-sm",children:"Đơn ho\xe0n th\xe0nh"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(null===(s=b.totals)||void 0===s?void 0:s.totalOrders)||0})]})]})}),(0,a.jsx)("div",{className:"stats-card",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-6 h-6 text-purple-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-dark-400 text-sm",children:"Gi\xe1 trị TB/đơn"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:(0,d.xG)((null===(h=b.totals)||void 0===h?void 0:h.avgOrderValue)||0)})]})]})})]}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"p-4 border-b border-dark-800",children:(0,a.jsx)("h2",{className:"font-semibold",children:"Biểu đồ doanh thu"})}),(0,a.jsx)("div",{className:"p-4",children:I?(0,a.jsx)("div",{className:"h-64 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full"})}):(null===(m=b.data)||void 0===m?void 0:m.length)===0?(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-dark-500",children:"Chưa c\xf3 dữ liệu"}):(0,a.jsx)("div",{className:"flex items-end justify-between h-64 gap-1 pt-6",children:null===(p=b.data)||void 0===p?void 0:p.map((e,t)=>{var s;let n=e.revenue/T*180;return(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center min-w-0",children:[(0,a.jsxs)("div",{className:"relative w-full max-w-[40px] mx-auto",children:[e.revenue>0&&(0,a.jsxs)("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 text-xs text-dark-400 whitespace-nowrap",children:[(e.revenue/1e6).toFixed(1),"M"]}),(0,a.jsx)("div",{className:"w-full bg-gradient-to-t from-primary-600 to-primary-400 rounded-t",style:{height:"".concat(Math.max(n,4),"px")},title:"".concat(e._id,": ").concat((0,d.xG)(e.revenue))})]}),(0,a.jsx)("div",{className:"text-xs text-dark-500 mt-2 truncate w-full text-center",children:null===(s=e._id)||void 0===s?void 0:s.split("-").slice(1).join("/")})]},t)})})})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"p-4 border-b border-dark-800",children:(0,a.jsx)("h2",{className:"font-semibold",children:"Sản phẩm b\xe1n chạy"})}),(0,a.jsx)("div",{className:"p-4 space-y-4",children:I?(0,a.jsx)("div",{className:"h-64 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full"})}):0===k.length?(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-dark-500",children:"Chưa c\xf3 dữ liệu"}):k.map((e,t)=>{var s;let n=(null===(s=k[0])||void 0===s?void 0:s.totalQuantity)||1,r=e.totalQuantity/n*100;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"badge ".concat(t<3?"badge-primary":"badge-gray"),children:t+1}),(0,a.jsx)("span",{className:"text-sm truncate",children:e.productName})]}),(0,a.jsxs)("span",{className:"text-sm text-dark-400",children:[e.totalQuantity," đ\xe3 b\xe1n"]})]}),(0,a.jsx)("div",{className:"h-2 bg-dark-800 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-primary-600 to-primary-400 rounded-full transition-all",style:{width:"".concat(r,"%")}})}),(0,a.jsxs)("p",{className:"text-xs text-dark-500 mt-1",children:["Doanh thu: ",(0,d.xG)(e.totalRevenue)]})]},e._id)})})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"p-4 border-b border-dark-800",children:(0,a.jsx)("h2",{className:"font-semibold",children:"Chi tiết theo ng\xe0y"})}),(0,a.jsx)("div",{className:"table-container border-0 rounded-none",children:I?(0,a.jsx)("div",{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full mx-auto"})}):(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Ng\xe0y"}),(0,a.jsx)("th",{className:"text-center",children:"Đơn ho\xe0n th\xe0nh"}),(0,a.jsx)("th",{className:"text-right",children:"Doanh thu"})]})}),(0,a.jsx)("tbody",{children:[...b.data||[]].reverse().map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"font-medium",children:e._id}),(0,a.jsx)("td",{className:"text-center",children:(0,a.jsx)("span",{className:"badge ".concat(e.orders>0?"badge-primary":"badge-gray"),children:e.orders})}),(0,a.jsx)("td",{className:"text-right font-medium text-green-400",children:(0,d.xG)(e.revenue)})]},e._id))})]})})]})]})}},189:function(e,t,s){"use strict";s.d(t,{F3:function(){return r},IK:function(){return u},Z9:function(){return i},ZE:function(){return d},fU:function(){return c},g3:function(){return o},kv:function(){return n},v2:function(){return h},vD:function(){return l}});let a=s(1892).Z.create({baseURL:"http://localhost:8080/api",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),a.interceptors.response.use(e=>e,e=>{var t,s,a,n,r,c;let o=(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Đ\xe3 xảy ra lỗi";return(null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.code)==="LICENSE_EXPIRED"&&(window.location.href="/license-expired"),(null===(r=e.response)||void 0===r?void 0:r.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject({message:o,...null===(c=e.response)||void 0===c?void 0:c.data})});let n={register:e=>a.post("/auth/register",e),login:e=>a.post("/auth/login",e),getMe:()=>a.get("/auth/me"),verifyEmail:e=>a.get("/auth/verify-email/".concat(e)),forgotPassword:e=>a.post("/auth/forgot-password",{email:e}),resetPassword:(e,t)=>a.post("/auth/reset-password/".concat(e),{password:t}),updateShop:e=>a.put("/auth/shop",e),changePassword:(e,t)=>a.put("/auth/change-password",{currentPassword:e,newPassword:t})},r={getAll:e=>a.get("/products",{params:e}),getById:e=>a.get("/products/".concat(e)),create:e=>a.post("/products",e),update:(e,t)=>a.put("/products/".concat(e),t),delete:e=>a.delete("/products/".concat(e)),getCategories:()=>a.get("/products/categories"),getLowStock:()=>a.get("/products/low-stock"),updateStock:(e,t,s)=>a.patch("/products/".concat(e,"/stock"),{adjustment:t,reason:s})},c={getAll:e=>a.get("/customers",{params:e}),getById:e=>a.get("/customers/".concat(e)),create:e=>a.post("/customers",e),update:(e,t)=>a.put("/customers/".concat(e),t),delete:e=>a.delete("/customers/".concat(e)),getOrders:e=>a.get("/customers/".concat(e,"/orders"))},o={getAll:e=>a.get("/orders",{params:e}),getById:e=>a.get("/orders/".concat(e)),create:e=>a.post("/orders",e),updateStatus:(e,t,s)=>a.patch("/orders/".concat(e,"/status"),{status:t,note:s}),cancel:(e,t)=>a.post("/orders/".concat(e,"/cancel"),{reason:t}),getStats:()=>a.get("/orders/stats")},l={getStats:()=>a.get("/dashboard/stats"),getRevenue:e=>a.get("/dashboard/revenue",{params:e}),getTopProducts:e=>a.get("/dashboard/top-products",{params:{limit:e}}),getRecentOrders:e=>a.get("/dashboard/recent-orders",{params:{limit:e}})},i={getAll:()=>a.get("/staff"),create:e=>a.post("/staff",e),update:(e,t)=>a.put("/staff/".concat(e),t),delete:e=>a.delete("/staff/".concat(e)),resetPassword:(e,t)=>a.post("/staff/".concat(e,"/reset-password"),{newPassword:t})},d={getAll:e=>a.get("/suppliers",{params:e}),getById:e=>a.get("/suppliers/".concat(e)),create:e=>a.post("/suppliers",e),update:(e,t)=>a.put("/suppliers/".concat(e),t),delete:e=>a.delete("/suppliers/".concat(e))},u={getAll:()=>a.get("/integrations"),get:e=>a.get("/integrations/".concat(e)),connect:(e,t)=>a.post("/integrations/".concat(e,"/connect"),t),disconnect:e=>a.post("/integrations/".concat(e,"/disconnect")),updateSettings:(e,t)=>a.patch("/integrations/".concat(e,"/settings"),t),syncProducts:e=>a.post("/integrations/".concat(e,"/sync-products")),syncOrders:e=>a.post("/integrations/".concat(e,"/sync-orders"))},h={get:()=>a.get("/tier-settings"),update:e=>a.put("/tier-settings",{tiers:e})}},229:function(e,t,s){"use strict";s.d(t,{AQ:function(){return i},cL:function(){return l},p6:function(){return o},tN:function(){return r},xG:function(){return c}});var a=s(8433),n=s(189);let r=(0,a.Ue)((e,t)=>({user:null,shop:null,token:localStorage.getItem("token"),isLoading:!0,isAuthenticated:!1,login:async(t,s)=>{let{data:a}=await n.kv.login({email:t,password:s});localStorage.setItem("token",a.token),e({user:a.user,shop:a.shop,token:a.token,isAuthenticated:!0,isLoading:!1})},register:async t=>{let{data:s}=await n.kv.register(t);localStorage.setItem("token",s.token),e({user:s.user,shop:s.shop,token:s.token,isAuthenticated:!0,isLoading:!1})},logout:()=>{localStorage.removeItem("token"),e({user:null,shop:null,token:null,isAuthenticated:!1,isLoading:!1})},fetchUser:async()=>{let t=localStorage.getItem("token");if(!t){e({isLoading:!1,isAuthenticated:!1});return}try{let{data:s}=await n.kv.getMe();e({user:s.user,shop:s.shop,token:t,isAuthenticated:!0,isLoading:!1})}catch(t){localStorage.removeItem("token"),e({user:null,shop:null,token:null,isAuthenticated:!1,isLoading:!1})}},setAuth:(t,s,a)=>{localStorage.setItem("token",a),e({user:t,shop:s,token:a,isAuthenticated:!0,isLoading:!1})},setShop:t=>{e({shop:t})}})),c=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={day:"2-digit",month:"2-digit",year:"numeric"};return t&&(s.hour="2-digit",s.minute="2-digit"),new Date(e).toLocaleDateString("vi-VN",s)},l={pending:"Chờ xử l\xfd",processing:"Đang xử l\xfd",shipping:"Đang giao",completed:"Ho\xe0n th\xe0nh",cancelled:"Đ\xe3 hủy"},i={pending:"warning",processing:"primary",shipping:"primary",completed:"success",cancelled:"danger"}}},function(e){e.O(0,[798,553,115,141,744],function(){return e(e.s=466)}),_N_E=e.O()}]);