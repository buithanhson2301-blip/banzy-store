(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[439],{3772:function(e,t,s){Promise.resolve().then(s.bind(s,9115))},9115:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var n=s(7821),a=s(8078),r=s(8347),c=s(2183),o=s(4440),l=s(3910),i=s(189),d=s(229),u=s(7485);function h(){let[e,t]=(0,a.useState)([]),[s,h]=(0,a.useState)([]),[p,g]=(0,a.useState)(!0),[m,x]=(0,a.useState)(""),[f,j]=(0,a.useState)(null),[b,N]=(0,a.useState)(""),k=async()=>{try{let[e,s]=await Promise.all([i.F3.getAll({search:m,limit:100}),i.F3.getLowStock()]);t(e.data.products),h(s.data)}catch(e){console.error("Failed to fetch inventory data:",e)}finally{g(!1)}};(0,a.useEffect)(()=>{k()},[]),(0,a.useEffect)(()=>{let e=setTimeout(()=>k(),300);return()=>clearTimeout(e)},[m]);let y=async()=>{if(b&&"0"!==b)try{await i.F3.updateStock(f._id,parseInt(b)),u.default.success("Đ\xe3 cập nhật tồn kho"),j(null),N(""),k()}catch(e){u.default.error(e.message||"C\xf3 lỗi xảy ra")}};return(0,n.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Quản l\xfd tồn kho"}),s.length>0&&(0,n.jsxs)("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,n.jsx)(r.Z,{className:"w-5 h-5 text-yellow-400"}),(0,n.jsxs)("h3",{className:"font-semibold text-yellow-400",children:["Sản phẩm sắp hết h\xe0ng (",s.length,")"]})]}),(0,n.jsx)("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:s.slice(0,6).map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between bg-dark-800 rounded-lg p-3",children:[(0,n.jsx)("span",{className:"font-medium truncate",children:e.name}),(0,n.jsxs)("span",{className:"badge badge-danger ml-2",children:["C\xf2n ",e.quantity]})]},e._id))})]}),(0,n.jsxs)("div",{className:"relative max-w-md",children:[(0,n.jsx)(c.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-500"}),(0,n.jsx)("input",{type:"text",className:"input pl-10",placeholder:"T\xecm kiếm sản phẩm...",value:m,onChange:e=>x(e.target.value)})]}),(0,n.jsx)("div",{className:"table-container",children:p?(0,n.jsx)("div",{className:"p-8 text-center",children:(0,n.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full mx-auto"})}):0===e.length?(0,n.jsx)("div",{className:"p-8 text-center text-dark-500",children:m?"Kh\xf4ng t\xecm thấy sản phẩm":"Chưa c\xf3 sản phẩm"}):(0,n.jsxs)("table",{className:"table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"M\xe3 SP"}),(0,n.jsx)("th",{children:"T\xean sản phẩm"}),(0,n.jsx)("th",{children:"Gi\xe1 b\xe1n"}),(0,n.jsx)("th",{children:"Tồn kho"}),(0,n.jsx)("th",{children:"Ngưỡng"}),(0,n.jsx)("th",{children:"Trạng th\xe1i"}),(0,n.jsx)("th",{children:"Điều chỉnh"})]})}),(0,n.jsx)("tbody",{children:e.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"font-medium",children:e.code||"-"}),(0,n.jsx)("td",{children:e.name}),(0,n.jsx)("td",{children:(0,d.xG)(e.price)}),(0,n.jsx)("td",{className:"font-bold text-lg",children:e.quantity}),(0,n.jsx)("td",{className:"text-dark-500",children:e.minStock}),(0,n.jsx)("td",{children:e.quantity<=e.minStock?(0,n.jsxs)("span",{className:"badge badge-danger",children:[(0,n.jsx)(r.Z,{className:"w-3 h-3 mr-1"}),"Sắp hết"]}):(0,n.jsx)("span",{className:"badge badge-success",children:"Đủ h\xe0ng"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"flex gap-1",children:[(0,n.jsx)("button",{className:"btn btn-secondary p-2",onClick:()=>{j(e),N("-1")},children:(0,n.jsx)(o.Z,{className:"w-4 h-4"})}),(0,n.jsx)("button",{className:"btn btn-secondary p-2",onClick:()=>{j(e),N("1")},children:(0,n.jsx)(l.Z,{className:"w-4 h-4"})})]})})]},e._id))})]})}),f&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)("div",{className:"bg-dark-900 border border-dark-800 rounded-xl w-full max-w-sm",children:[(0,n.jsx)("div",{className:"p-4 border-b border-dark-800",children:(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Điều chỉnh tồn kho"})}),(0,n.jsxs)("div",{className:"p-4 space-y-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-dark-400",children:"Sản phẩm"}),(0,n.jsx)("p",{className:"font-semibold text-lg",children:f.name}),(0,n.jsxs)("p",{className:"text-dark-400 mt-2",children:["Tồn kho hiện tại: ",(0,n.jsx)("span",{className:"font-bold text-white",children:f.quantity})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Số lượng điều chỉnh"}),(0,n.jsx)("input",{type:"number",className:"input text-center text-lg",value:b,onChange:e=>N(e.target.value),placeholder:"+10 hoặc -5"}),(0,n.jsx)("p",{className:"text-sm text-dark-500 mt-1 text-center",children:"Nhập số dương để tăng, số \xe2m để giảm"})]}),b&&(0,n.jsxs)("p",{className:"text-center",children:["Tồn kho mới: ",(0,n.jsx)("span",{className:"font-bold ".concat(f.quantity+parseInt(b)<0?"text-red-400":"text-green-400"),children:f.quantity+parseInt(b||"0")})]})]}),(0,n.jsxs)("div",{className:"p-4 border-t border-dark-800 flex gap-3",children:[(0,n.jsx)("button",{className:"btn btn-secondary flex-1",onClick:()=>{j(null),N("")},children:"Hủy"}),(0,n.jsx)("button",{className:"btn btn-primary flex-1",onClick:y,disabled:!b||"0"===b||f.quantity+parseInt(b||"0")<0,children:"X\xe1c nhận"})]})]})})]})}},189:function(e,t,s){"use strict";s.d(t,{F3:function(){return r},IK:function(){return u},Z9:function(){return i},ZE:function(){return d},fU:function(){return c},g3:function(){return o},kv:function(){return a},v2:function(){return h},vD:function(){return l}});let n=s(1892).Z.create({baseURL:"http://localhost:8080/api",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),n.interceptors.response.use(e=>e,e=>{var t,s,n,a,r,c;let o=(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Đ\xe3 xảy ra lỗi";return(null===(a=e.response)||void 0===a?void 0:null===(n=a.data)||void 0===n?void 0:n.code)==="LICENSE_EXPIRED"&&(window.location.href="/license-expired"),(null===(r=e.response)||void 0===r?void 0:r.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject({message:o,...null===(c=e.response)||void 0===c?void 0:c.data})});let a={register:e=>n.post("/auth/register",e),login:e=>n.post("/auth/login",e),getMe:()=>n.get("/auth/me"),verifyEmail:e=>n.get("/auth/verify-email/".concat(e)),forgotPassword:e=>n.post("/auth/forgot-password",{email:e}),resetPassword:(e,t)=>n.post("/auth/reset-password/".concat(e),{password:t}),updateShop:e=>n.put("/auth/shop",e),changePassword:(e,t)=>n.put("/auth/change-password",{currentPassword:e,newPassword:t})},r={getAll:e=>n.get("/products",{params:e}),getById:e=>n.get("/products/".concat(e)),create:e=>n.post("/products",e),update:(e,t)=>n.put("/products/".concat(e),t),delete:e=>n.delete("/products/".concat(e)),getCategories:()=>n.get("/products/categories"),getLowStock:()=>n.get("/products/low-stock"),updateStock:(e,t,s)=>n.patch("/products/".concat(e,"/stock"),{adjustment:t,reason:s})},c={getAll:e=>n.get("/customers",{params:e}),getById:e=>n.get("/customers/".concat(e)),create:e=>n.post("/customers",e),update:(e,t)=>n.put("/customers/".concat(e),t),delete:e=>n.delete("/customers/".concat(e)),getOrders:e=>n.get("/customers/".concat(e,"/orders"))},o={getAll:e=>n.get("/orders",{params:e}),getById:e=>n.get("/orders/".concat(e)),create:e=>n.post("/orders",e),updateStatus:(e,t,s)=>n.patch("/orders/".concat(e,"/status"),{status:t,note:s}),cancel:(e,t)=>n.post("/orders/".concat(e,"/cancel"),{reason:t}),getStats:()=>n.get("/orders/stats")},l={getStats:()=>n.get("/dashboard/stats"),getRevenue:e=>n.get("/dashboard/revenue",{params:e}),getTopProducts:e=>n.get("/dashboard/top-products",{params:{limit:e}}),getRecentOrders:e=>n.get("/dashboard/recent-orders",{params:{limit:e}})},i={getAll:()=>n.get("/staff"),create:e=>n.post("/staff",e),update:(e,t)=>n.put("/staff/".concat(e),t),delete:e=>n.delete("/staff/".concat(e)),resetPassword:(e,t)=>n.post("/staff/".concat(e,"/reset-password"),{newPassword:t})},d={getAll:e=>n.get("/suppliers",{params:e}),getById:e=>n.get("/suppliers/".concat(e)),create:e=>n.post("/suppliers",e),update:(e,t)=>n.put("/suppliers/".concat(e),t),delete:e=>n.delete("/suppliers/".concat(e))},u={getAll:()=>n.get("/integrations"),get:e=>n.get("/integrations/".concat(e)),connect:(e,t)=>n.post("/integrations/".concat(e,"/connect"),t),disconnect:e=>n.post("/integrations/".concat(e,"/disconnect")),updateSettings:(e,t)=>n.patch("/integrations/".concat(e,"/settings"),t),syncProducts:e=>n.post("/integrations/".concat(e,"/sync-products")),syncOrders:e=>n.post("/integrations/".concat(e,"/sync-orders"))},h={get:()=>n.get("/tier-settings"),update:e=>n.put("/tier-settings",{tiers:e})}},229:function(e,t,s){"use strict";s.d(t,{AQ:function(){return i},cL:function(){return l},p6:function(){return o},tN:function(){return r},xG:function(){return c}});var n=s(8433),a=s(189);let r=(0,n.Ue)((e,t)=>({user:null,shop:null,token:localStorage.getItem("token"),isLoading:!0,isAuthenticated:!1,login:async(t,s)=>{let{data:n}=await a.kv.login({email:t,password:s});localStorage.setItem("token",n.token),e({user:n.user,shop:n.shop,token:n.token,isAuthenticated:!0,isLoading:!1})},register:async t=>{let{data:s}=await a.kv.register(t);localStorage.setItem("token",s.token),e({user:s.user,shop:s.shop,token:s.token,isAuthenticated:!0,isLoading:!1})},logout:()=>{localStorage.removeItem("token"),e({user:null,shop:null,token:null,isAuthenticated:!1,isLoading:!1})},fetchUser:async()=>{let t=localStorage.getItem("token");if(!t){e({isLoading:!1,isAuthenticated:!1});return}try{let{data:s}=await a.kv.getMe();e({user:s.user,shop:s.shop,token:t,isAuthenticated:!0,isLoading:!1})}catch(t){localStorage.removeItem("token"),e({user:null,shop:null,token:null,isAuthenticated:!1,isLoading:!1})}},setAuth:(t,s,n)=>{localStorage.setItem("token",n),e({user:t,shop:s,token:n,isAuthenticated:!0,isLoading:!1})},setShop:t=>{e({shop:t})}})),c=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={day:"2-digit",month:"2-digit",year:"numeric"};return t&&(s.hour="2-digit",s.minute="2-digit"),new Date(e).toLocaleDateString("vi-VN",s)},l={pending:"Chờ xử l\xfd",processing:"Đang xử l\xfd",shipping:"Đang giao",completed:"Ho\xe0n th\xe0nh",cancelled:"Đ\xe3 hủy"},i={pending:"warning",processing:"primary",shipping:"primary",completed:"success",cancelled:"danger"}}},function(e){e.O(0,[798,487,115,141,744],function(){return e(e.s=3772)}),_N_E=e.O()}]);