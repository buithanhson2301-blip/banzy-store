(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{8667:function(t,e,n){Promise.resolve().then(n.bind(n,946))},946:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return p}});var s=n(7821),a=n(8078),o=n(6179),i=n(5498),r=n(3587),c=n(8037),d=n(189),l=n(229),h=n(7485);function p(){let{id:t}=(0,o.useParams)(),e=(0,o.useRouter)(),{shop:n}=(0,l.tN)(),[p,g]=(0,a.useState)(null),[u,m]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{let n=async()=>{try{let{data:e}=await d.g3.getById(t);g(e)}catch(t){h.default.error("Kh\xf4ng thể tải đơn h\xe0ng"),e.push("/dashboard/orders")}finally{m(!1)}};t&&n()},[t,e]),u)?(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full"})}):p?(0,s.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("button",{className:"btn btn-ghost p-2",onClick:()=>e.back(),children:(0,s.jsx)(i.Z,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold",children:["Đơn h\xe0ng ",p.orderCode]}),(0,s.jsx)("span",{className:"badge badge-".concat(l.AQ[p.status]),children:l.cL[p.status]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("button",{className:"btn btn-secondary",onClick:()=>{let t=window.open("","_blank");if(!t)return;let e="\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>H\xf3a đơn ".concat(p.orderCode,'</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          body { font-family: \'Segoe UI\', Arial, sans-serif; padding: 20px; font-size: 14px; }\n          .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }\n          .header h1 { font-size: 24px; margin-bottom: 5px; }\n          .header .shop-name { font-size: 18px; font-weight: bold; color: #333; }\n          .info { display: flex; justify-content: space-between; margin-bottom: 20px; }\n          .info-box { flex: 1; }\n          .info-box h3 { font-size: 12px; text-transform: uppercase; color: #666; margin-bottom: 8px; }\n          .info-box p { margin: 4px 0; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }\n          th { background: #f5f5f5; font-weight: 600; }\n          .text-right { text-align: right; }\n          .total { font-size: 18px; font-weight: bold; }\n          .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; }\n          @media print {\n            body { padding: 0; }\n            @page { margin: 1cm; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <div class="shop-name">').concat((null==n?void 0:n.name)||"QALY BAHA","</div>\n          <h1>H\xd3A ĐƠN B\xc1N H\xc0NG</h1>\n          <p>M\xe3 đơn: <strong>").concat(p.orderCode,"</strong></p>\n          <p>Ng\xe0y: ").concat((0,l.p6)(p.createdAt,!0),'</p>\n        </div>\n        \n        <div class="info">\n          <div class="info-box">\n            <h3>Th\xf4ng tin kh\xe1ch h\xe0ng</h3>\n            <p><strong>').concat(p.customerName||"Kh\xe1ch v\xe3ng lai","</strong></p>\n            <p>ĐT: ").concat(p.customerPhone||"-","</p>\n            <p>Địa chỉ: ").concat(p.shippingAddress||"-",'</p>\n          </div>\n          <div class="info-box" style="text-align: right;">\n            <h3>Trạng th\xe1i</h3>\n            <p><strong>').concat(l.cL[p.status],'</strong></p>\n          </div>\n        </div>\n        \n        <table>\n          <thead>\n            <tr>\n              <th style="width: 40px;">STT</th>\n              <th>Sản phẩm</th>\n              <th class="text-right" style="width: 100px;">Đơn gi\xe1</th>\n              <th class="text-right" style="width: 60px;">SL</th>\n              <th class="text-right" style="width: 120px;">Th\xe0nh tiền</th>\n            </tr>\n          </thead>\n          <tbody>\n            ').concat(p.items.map((t,e)=>"\n              <tr>\n                <td>".concat(e+1,"</td>\n                <td>").concat(t.productName,'</td>\n                <td class="text-right">').concat((0,l.xG)(t.price),'</td>\n                <td class="text-right">').concat(t.quantity,'</td>\n                <td class="text-right">').concat((0,l.xG)(t.price*t.quantity),"</td>\n              </tr>\n            ")).join(""),'\n          </tbody>\n          <tfoot>\n            <tr>\n              <td colspan="4" class="text-right"><strong>Tổng cộng:</strong></td>\n              <td class="text-right total">').concat((0,l.xG)(p.total),"</td>\n            </tr>\n          </tfoot>\n        </table>\n        \n        ").concat(p.note?"<p><strong>Ghi ch\xfa:</strong> ".concat(p.note,"</p>"):"",'\n        \n        <div class="footer">\n          <p>Cảm ơn qu\xfd kh\xe1ch đ\xe3 mua h\xe0ng!</p>\n          <p>Powered by QALY BAHA</p>\n        </div>\n        \n        <script>window.print();</script>\n      </body>\n      </html>\n    ');t.document.write(e),t.document.close()},children:[(0,s.jsx)(r.Z,{className:"w-4 h-4"})," In h\xf3a đơn"]}),(0,s.jsxs)("button",{className:"btn btn-secondary",onClick:()=>{let t=window.open("","_blank");if(!t)return;let e="\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Phiếu giao h\xe0ng ".concat(p.orderCode,'</title>\n        <style>\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          body { font-family: \'Segoe UI\', Arial, sans-serif; padding: 20px; font-size: 14px; }\n          .header { text-align: center; margin-bottom: 30px; }\n          .header h1 { font-size: 24px; margin-bottom: 5px; border: 2px solid #333; padding: 10px; display: inline-block; }\n          .important { background: #f8f8f8; padding: 15px; border: 1px dashed #ccc; margin-bottom: 20px; }\n          .important h2 { font-size: 16px; margin-bottom: 10px; }\n          .recipient { font-size: 18px; font-weight: bold; }\n          table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n          th { background: #f5f5f5; }\n          .text-right { text-align: right; }\n          .cod { font-size: 20px; font-weight: bold; color: #d00; text-align: center; margin-top: 20px; padding: 20px; border: 2px solid #d00; }\n          .signatures { display: flex; justify-content: space-between; margin-top: 50px; text-align: center; }\n          .signatures div { width: 30%; }\n          .signatures p:first-child { font-weight: bold; margin-bottom: 60px; }\n          @media print {\n            body { padding: 0; }\n            @page { margin: 1cm; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>PHIẾU GIAO H\xc0NG</h1>\n          <p style="margin-top: 10px;">M\xe3 đơn: <strong>').concat(p.orderCode,"</strong> | Ng\xe0y: ").concat((0,l.p6)(p.createdAt),'</p>\n        </div>\n        \n        <div class="important">\n          <h2>NGƯỜI NHẬN</h2>\n          <p class="recipient">').concat(p.customerName||"Kh\xe1ch v\xe3ng lai","</p>\n          <p>ĐT: <strong>").concat(p.customerPhone||"-","</strong></p>\n          <p>Địa chỉ: <strong>").concat(p.shippingAddress,'</strong></p>\n        </div>\n        \n        <table>\n          <thead>\n            <tr>\n              <th>STT</th>\n              <th>Sản phẩm</th>\n              <th class="text-right">SL</th>\n            </tr>\n          </thead>\n          <tbody>\n            ').concat(p.items.map((t,e)=>"\n              <tr>\n                <td>".concat(e+1,"</td>\n                <td>").concat(t.productName,'</td>\n                <td class="text-right">').concat(t.quantity,"</td>\n              </tr>\n            ")).join(""),'\n          </tbody>\n        </table>\n        \n        <div class="cod">\n          THU HỘ (COD): ').concat((0,l.xG)(p.total),'\n        </div>\n        \n        <div class="signatures">\n          <div>\n            <p>Người gửi</p>\n            <p>').concat((null==n?void 0:n.name)||"","</p>\n          </div>\n          <div>\n            <p>Người vận chuyển</p>\n            <p>________________</p>\n          </div>\n          <div>\n            <p>Người nhận</p>\n            <p>________________</p>\n          </div>\n        </div>\n        \n        <script>window.print();</script>\n      </body>\n      </html>\n    ");t.document.write(e),t.document.close()},children:[(0,s.jsx)(c.Z,{className:"w-4 h-4"})," In phiếu giao"]})]})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h3",{className:"font-semibold mb-3",children:"Th\xf4ng tin kh\xe1ch h\xe0ng"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-dark-400",children:"T\xean:"})," ",(0,s.jsx)("span",{className:"font-medium",children:p.customerName||"Kh\xe1ch v\xe3ng lai"})]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-dark-400",children:"Điện thoại:"})," ",p.customerPhone||"-"]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-dark-400",children:"Địa chỉ giao:"})," ",p.shippingAddress]})]})]}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h3",{className:"font-semibold mb-3",children:"Th\xf4ng tin đơn h\xe0ng"}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-dark-400",children:"M\xe3 đơn:"})," ",(0,s.jsx)("span",{className:"font-mono",children:p.orderCode})]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-dark-400",children:"Ng\xe0y tạo:"})," ",(0,l.p6)(p.createdAt,!0)]}),p.note&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"text-dark-400",children:"Ghi ch\xfa:"})," ",p.note]})]})]})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"p-4 border-b border-dark-800",children:(0,s.jsx)("h3",{className:"font-semibold",children:"Chi tiết sản phẩm"})}),(0,s.jsx)("div",{className:"table-container border-0 rounded-none",children:(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Sản phẩm"}),(0,s.jsx)("th",{className:"text-right",children:"Đơn gi\xe1"}),(0,s.jsx)("th",{className:"text-center",children:"SL"}),(0,s.jsx)("th",{className:"text-right",children:"Th\xe0nh tiền"})]})}),(0,s.jsx)("tbody",{children:p.items.map((t,e)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"font-medium",children:t.productName}),(0,s.jsx)("td",{className:"text-right",children:(0,l.xG)(t.price)}),(0,s.jsx)("td",{className:"text-center",children:t.quantity}),(0,s.jsx)("td",{className:"text-right font-medium",children:(0,l.xG)(t.price*t.quantity)})]},e))}),(0,s.jsx)("tfoot",{children:(0,s.jsxs)("tr",{className:"bg-dark-800",children:[(0,s.jsx)("td",{colSpan:3,className:"text-right font-semibold",children:"Tổng cộng:"}),(0,s.jsx)("td",{className:"text-right font-bold text-lg text-green-400",children:(0,l.xG)(p.total)})]})})]})})]}),!["completed","cancelled"].includes(p.status)&&(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h3",{className:"font-semibold mb-4",children:"Cập nhật trạng th\xe1i"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:["pending"===p.status&&(0,s.jsx)("button",{className:"btn btn-primary",onClick:async()=>{try{await d.g3.updateStatus(p._id,"processing"),h.default.success("Đ\xe3 x\xe1c nhận đơn h\xe0ng");let{data:e}=await d.g3.getById(t);g(e)}catch(t){h.default.error(t.message)}},children:"✓ X\xe1c nhận đơn h\xe0ng"}),"processing"===p.status&&(0,s.jsx)("button",{className:"btn btn-primary",onClick:async()=>{try{await d.g3.updateStatus(p._id,"shipping"),h.default.success("Đ\xe3 chuyển sang đang giao");let{data:e}=await d.g3.getById(t);g(e)}catch(t){h.default.error(t.message)}},children:"\uD83D\uDE9A Bắt đầu giao h\xe0ng"}),"shipping"===p.status&&(0,s.jsx)("button",{className:"btn btn-primary",onClick:async()=>{try{await d.g3.updateStatus(p._id,"completed"),h.default.success("Đơn h\xe0ng ho\xe0n th\xe0nh!");let{data:e}=await d.g3.getById(t);g(e)}catch(t){h.default.error(t.message)}},children:"✅ Ho\xe0n th\xe0nh đơn h\xe0ng"}),(0,s.jsx)("button",{className:"btn btn-danger",onClick:async()=>{if(confirm("Bạn c\xf3 chắc muốn hủy đơn h\xe0ng n\xe0y?"))try{await d.g3.cancel(p._id,"Hủy bởi admin"),h.default.success("Đ\xe3 hủy đơn h\xe0ng");let{data:e}=await d.g3.getById(t);g(e)}catch(t){h.default.error(t.message)}},children:"✕ Hủy đơn h\xe0ng"})]})]}),p.statusHistory&&p.statusHistory.length>0&&(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h3",{className:"font-semibold mb-4",children:"Lịch sử trạng th\xe1i"}),(0,s.jsx)("div",{className:"space-y-3",children:p.statusHistory.map((t,e)=>(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("span",{className:"font-medium",children:l.cL[t.status]}),(0,s.jsx)("span",{className:"text-dark-500 ml-2",children:(0,l.p6)(t.changedAt,!0)})]})]},e))})]})]}):null}},189:function(t,e,n){"use strict";n.d(e,{F3:function(){return o},IK:function(){return h},Z9:function(){return d},ZE:function(){return l},fU:function(){return i},g3:function(){return r},kv:function(){return a},v2:function(){return p},vD:function(){return c}});let s=n(1892).Z.create({baseURL:"http://localhost:8080/api",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(t=>{{let e=localStorage.getItem("token");e&&(t.headers.Authorization="Bearer ".concat(e))}return t}),s.interceptors.response.use(t=>t,t=>{var e,n,s,a,o,i;let r=(null===(n=t.response)||void 0===n?void 0:null===(e=n.data)||void 0===e?void 0:e.message)||"Đ\xe3 xảy ra lỗi";return(null===(a=t.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.code)==="LICENSE_EXPIRED"&&(window.location.href="/license-expired"),(null===(o=t.response)||void 0===o?void 0:o.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject({message:r,...null===(i=t.response)||void 0===i?void 0:i.data})});let a={register:t=>s.post("/auth/register",t),login:t=>s.post("/auth/login",t),getMe:()=>s.get("/auth/me"),verifyEmail:t=>s.get("/auth/verify-email/".concat(t)),forgotPassword:t=>s.post("/auth/forgot-password",{email:t}),resetPassword:(t,e)=>s.post("/auth/reset-password/".concat(t),{password:e}),updateShop:t=>s.put("/auth/shop",t),changePassword:(t,e)=>s.put("/auth/change-password",{currentPassword:t,newPassword:e})},o={getAll:t=>s.get("/products",{params:t}),getById:t=>s.get("/products/".concat(t)),create:t=>s.post("/products",t),update:(t,e)=>s.put("/products/".concat(t),e),delete:t=>s.delete("/products/".concat(t)),getCategories:()=>s.get("/products/categories"),getLowStock:()=>s.get("/products/low-stock"),updateStock:(t,e,n)=>s.patch("/products/".concat(t,"/stock"),{adjustment:e,reason:n})},i={getAll:t=>s.get("/customers",{params:t}),getById:t=>s.get("/customers/".concat(t)),create:t=>s.post("/customers",t),update:(t,e)=>s.put("/customers/".concat(t),e),delete:t=>s.delete("/customers/".concat(t)),getOrders:t=>s.get("/customers/".concat(t,"/orders"))},r={getAll:t=>s.get("/orders",{params:t}),getById:t=>s.get("/orders/".concat(t)),create:t=>s.post("/orders",t),updateStatus:(t,e,n)=>s.patch("/orders/".concat(t,"/status"),{status:e,note:n}),cancel:(t,e)=>s.post("/orders/".concat(t,"/cancel"),{reason:e}),getStats:()=>s.get("/orders/stats")},c={getStats:()=>s.get("/dashboard/stats"),getRevenue:t=>s.get("/dashboard/revenue",{params:t}),getTopProducts:t=>s.get("/dashboard/top-products",{params:{limit:t}}),getRecentOrders:t=>s.get("/dashboard/recent-orders",{params:{limit:t}})},d={getAll:()=>s.get("/staff"),create:t=>s.post("/staff",t),update:(t,e)=>s.put("/staff/".concat(t),e),delete:t=>s.delete("/staff/".concat(t)),resetPassword:(t,e)=>s.post("/staff/".concat(t,"/reset-password"),{newPassword:e})},l={getAll:t=>s.get("/suppliers",{params:t}),getById:t=>s.get("/suppliers/".concat(t)),create:t=>s.post("/suppliers",t),update:(t,e)=>s.put("/suppliers/".concat(t),e),delete:t=>s.delete("/suppliers/".concat(t))},h={getAll:()=>s.get("/integrations"),get:t=>s.get("/integrations/".concat(t)),connect:(t,e)=>s.post("/integrations/".concat(t,"/connect"),e),disconnect:t=>s.post("/integrations/".concat(t,"/disconnect")),updateSettings:(t,e)=>s.patch("/integrations/".concat(t,"/settings"),e),syncProducts:t=>s.post("/integrations/".concat(t,"/sync-products")),syncOrders:t=>s.post("/integrations/".concat(t,"/sync-orders"))},p={get:()=>s.get("/tier-settings"),update:t=>s.put("/tier-settings",{tiers:t})}},229:function(t,e,n){"use strict";n.d(e,{AQ:function(){return d},cL:function(){return c},p6:function(){return r},tN:function(){return o},xG:function(){return i}});var s=n(8433),a=n(189);let o=(0,s.Ue)((t,e)=>({user:null,shop:null,token:localStorage.getItem("token"),isLoading:!0,isAuthenticated:!1,login:async(e,n)=>{let{data:s}=await a.kv.login({email:e,password:n});localStorage.setItem("token",s.token),t({user:s.user,shop:s.shop,token:s.token,isAuthenticated:!0,isLoading:!1})},register:async e=>{let{data:n}=await a.kv.register(e);localStorage.setItem("token",n.token),t({user:n.user,shop:n.shop,token:n.token,isAuthenticated:!0,isLoading:!1})},logout:()=>{localStorage.removeItem("token"),t({user:null,shop:null,token:null,isAuthenticated:!1,isLoading:!1})},fetchUser:async()=>{let e=localStorage.getItem("token");if(!e){t({isLoading:!1,isAuthenticated:!1});return}try{let{data:n}=await a.kv.getMe();t({user:n.user,shop:n.shop,token:e,isAuthenticated:!0,isLoading:!1})}catch(e){localStorage.removeItem("token"),t({user:null,shop:null,token:null,isAuthenticated:!1,isLoading:!1})}},setAuth:(e,n,s)=>{localStorage.setItem("token",s),t({user:e,shop:n,token:s,isAuthenticated:!0,isLoading:!1})},setShop:e=>{t({shop:e})}})),i=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t),r=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={day:"2-digit",month:"2-digit",year:"numeric"};return e&&(n.hour="2-digit",n.minute="2-digit"),new Date(t).toLocaleDateString("vi-VN",n)},c={pending:"Chờ xử l\xfd",processing:"Đang xử l\xfd",shipping:"Đang giao",completed:"Ho\xe0n th\xe0nh",cancelled:"Đ\xe3 hủy"},d={pending:"warning",processing:"primary",shipping:"primary",completed:"success",cancelled:"danger"}}},function(t){t.O(0,[798,479,115,141,744],function(){return t(t.s=8667)}),_N_E=t.O()}]);